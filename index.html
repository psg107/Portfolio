<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./style.css" rel="stylesheet">
    <title>포트폴리오</title>
</head>

<body>
    <header>
        <h1>포트폴리오</h1>
    </header>
    <div class="container">
        <div class="main">
            <div class="modal-overlay" id="modalOverlay">
                <div class="modal-content">
                    <img src="" alt="image" id="modalImage">
                </div>
            </div>

            <!-- 프로필 -->
            <div class="section section-profile">
                <h2>프로필</h2>
                <p>개발자 박상곤입니다.</p>
            </div>

            <!-- 연락처 -->
            <div class="section section-contact">
                <h2>연락처</h2>
                <p>Email: psg107@naver.com</p>
                <p>GitHub: <a href="https://github.com/psg107" target="_blank">https://github.com/psg107</a></p>
                <p>Wanted: <a href="https://social.wanted.co.kr/community/profile/fF4YAhwmRNWyJMRxgtcTjo" target="_blank">https://social.wanted.co.kr/community/profile/fF4YAhwmRNWyJMRxgtcTjo</a></p>
            </div>

            <!-- 스킬 -->
            <div class="section section-skills">
                <h2>사용 기술</h2>
                <div class="skill-list"></div>
            </div>

            <!-- 프로젝트 -->
            <div class="section section-project">
                <h2>프로젝트</h2>
                <div class="projects"></div>
            </div>
        </div>
    </div>

    <script>
        const fetchProjects = async () => {
            try {
                const response = await fetch('projects.json?' + new Date().getTime());
                const projects = await response.json();
                return projects;
            } catch (error) {
                console.error('프로젝트 데이터를 불러오는 데 실패했습니다:', error);
                return [];
            }
        };

        const createProjectSection = (projects) => {
            let projectSection = document.querySelector('.section > .projects');
            
            projects.forEach(project => {
                const projectUrl = project.repositoryType !== "Private" ? project.repositoryUrl : null;
                const url = projectUrl ?? project.link;

                projectSection.innerHTML += `
                    <div class="project">
                        <div class="project-header">
                            <h3 class="name">${project.name}</h3>
                            <div class="date-btn-container">
                                <p class="date">(${project.date})</p>
                                ${project.image != null ? `<button class="show-image-btn" data-image-url="${project.image}">🖼️</button>` : ""}
                            </div>
                        </div>

                        <p class="skills">${project.skills.join(', ')}</p>
                        <p class="description">${project.description.replaceAll("\n", "<br/>")}</p>
                        
                        ${url != null ? `<a class="link" target="_blank" href='${url}'>${url}</a>` : ""}
                    </div>
                `;
            });
        };

        const createSkillsSection = (projects) => {
            const skillsElement = document.querySelector('.skill-list');
            const skills = projects.flatMap(x => x.skills);
            const sortedSkills = Array.from(
                skills.reduce((map, skill) => map.set(skill, (map.get(skill) || 0) + 1), new Map())
            )
            .sort((a, b) => b[1] - a[1])
            .map(([skill]) => skill);
            skillsElement.innerHTML = sortedSkills.join(", ");
        };

        const initializeModal = () => {
            const showImageButtons = document.querySelectorAll('.show-image-btn');
            const modalOverlay = document.getElementById('modalOverlay');
            const modalImage = document.getElementById('modalImage');

            showImageButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const imageUrl = button.getAttribute('data-image-url');
                    if (imageUrl) {
                        modalImage.src = './images/' + imageUrl;
                        modalOverlay.style.display = 'flex';
                    }
                });
            });

            modalOverlay.addEventListener('click', () => {
                modalOverlay.style.display = 'none';
            });
        };

        const main = async () => {
            const projects = await fetchProjects();

            createProjectSection(projects);
            createSkillsSection(projects);
            initializeModal();
        };

        window.addEventListener('DOMContentLoaded', main);
    </script>
</body>

</html>